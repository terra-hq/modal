(function(l,a){typeof exports=="object"&&typeof module<"u"?module.exports=a():typeof define=="function"&&define.amd?define(a):(l=typeof globalThis<"u"?globalThis:l||self,l.Modal=a())})(this,function(){"use strict";class l{constructor(t={}){if(!(t.selector instanceof Element)){console.warn("[Modal] selector must be a DOM Element. Modal not initialized."),this._disabled=!0;return}const n={onShow:e=>{t.debug&&console.info(`${e.id||"[no-id]"} is shown`)},onClose:e=>{t.debug&&console.info(`${e.id||"[no-id]"} is hidden`)},beforeOpen:()=>{},beforeClose:()=>{},onError:null,openTrigger:"data-modal-open",closeTrigger:"data-modal-close",openClass:"c--modal-a--is-open",disableScroll:!0,debug:!1};this.settings={...n,...t},this._safe=(e,...s)=>{if(typeof e=="function")try{e(...s)}catch(i){if(console.error("[Modal callback error]",i),typeof this.settings.onError=="function")try{this.settings.onError(i,{args:s})}catch{}}},this._report=(e,s,i={})=>{var o;if(console.error(`[Modal] ${s}`,i),typeof((o=this.settings)==null?void 0:o.onError)=="function")try{this.settings.onError(new Error(s),{method:e,...i})}catch{}},this.DOM={modal:this.settings.selector,openTriggers:document.querySelectorAll(`[${this.settings.openTrigger}="${this.settings.selector.id}"]`),closeTriggers:this.settings.selector.querySelectorAll(`[${this.settings.closeTrigger}]`)},this._busy=!1,this._destroyed=!1,this._attachEsc=null,this._disabled=!1,this.eventListeners=[],this.init(),this.events()}logDebug(t){this.settings.debug&&console.debug(`[Modal Debug]: ${t}`)}init(){if(!this.DOM.modal)throw new Error(`No modal found with selector "${this.settings.selector}".`);this.logDebug(`Found modal with selector "${this.settings.selector}".`)}events(){this.addEventListeners(this.DOM.modal)}addEventListeners(t){const n=t.id;this.DOM.openTriggers.forEach(s=>{if(s.getAttribute(this.settings.openTrigger)===n){const i=o=>{var r;o.preventDefault();const c={type:"element",element:s,tagName:s.tagName.toLowerCase(),text:((r=s.textContent)==null?void 0:r.trim())||"",id:s.id||null};this.open(t,c)};s.addEventListener("click",i),this.eventListeners.push({element:s,type:"click",listener:i})}}),t.querySelectorAll(`[${this.settings.closeTrigger}]`).forEach(s=>{const i=o=>{var r;o.preventDefault(),this.logDebug(`Close trigger clicked for modal ID: ${n}`);const c={type:"element",element:s,tagName:s.tagName.toLowerCase(),text:((r=s.textContent)==null?void 0:r.trim())||"",id:s.id||null,action:"close"};this.close(t,c)};s.addEventListener("click",i),this.eventListeners.push({element:s,type:"click",listener:i})});const e=t.querySelector("[data-modal-overlay], .c--modal-a__overlay");if(e){const s=i=>{if(i.target===e){this.logDebug(`Overlay clicked for modal ID: ${n}`);const o={type:"overlay",element:e,action:"close"};this.close(t,o)}};e.addEventListener("click",s),this.eventListeners.push({element:e,type:"click",listener:s})}}_ensureEscAttached(){this._attachEsc||(this._attachEsc=t=>{t.key==="Escape"&&this.isOpen(this.DOM.modal)&&this.close(this.DOM.modal,{type:"keyboard",key:"Escape",action:"close"})},document.addEventListener("keydown",this._attachEsc))}_removeEsc(){this._attachEsc&&(document.removeEventListener("keydown",this._attachEsc),this._attachEsc=null)}open(t,n=null){var i;if(this._disabled){this._report("open","Instance is disabled (invalid selector on init).");return}const e=t instanceof Element?t:(i=this.DOM)==null?void 0:i.modal;if(!(e instanceof Element)){this._report("open","No modal Element found. Pass a DOM Element or ensure this instance was initialized with a valid selector.",{passed:t});return}if(this._busy||this.isOpen(e))return;this._busy=!0;const s=n||{type:"programmatic",source:"manual",method:"open()"};this._safe(this.settings.beforeOpen,e,s),this.logDebug(`Opening modal ID: ${e.id}`),e.classList.add(this.settings.openClass),e.setAttribute("aria-hidden","false"),this.settings.disableScroll&&(document.body.style.overflow="hidden"),this._ensureEscAttached(),this._safe(this.settings.onShow,e,s),this._busy=!1}close(t,n=null){var i;if(this._disabled){this._report("close","Instance is disabled (invalid selector on init).");return}const e=t instanceof Element?t:(i=this.DOM)==null?void 0:i.modal;if(!(e instanceof Element)){this._report("close","No modal Element found. Pass a DOM Element or ensure this instance was initialized with a valid selector.",{passed:t});return}if(this._busy||!this.isOpen(e))return;this._busy=!0;const s=n||{type:"programmatic",source:"manual",method:"close()",action:"close"};this._safe(this.settings.beforeClose,e,s),this.logDebug(`Closing modal ID: ${e.id}`),e.classList.remove(this.settings.openClass),e.setAttribute("aria-hidden","true"),this.settings.disableScroll&&(document.body.style.overflow=""),this._removeEsc(),this._safe(this.settings.onClose,e,s),this._busy=!1}isOpen(t){return t.classList.contains(this.settings.openClass)}toggle(){var t;if(!((t=this.DOM)!=null&&t.modal)){this._report("toggle","No modal element found.");return}this.isOpen(this.DOM.modal)?this.close(this.DOM.modal):this.open(this.DOM.modal)}destroy(){this._destroyed||(this.logDebug("Destroying all event listeners."),this.eventListeners.forEach(({element:t,type:n,listener:e})=>{t.removeEventListener(n,e)}),this.eventListeners=[],this._removeEsc(),this._destroyed=!0,console.info("All modal event listeners have been removed."))}}return l});
